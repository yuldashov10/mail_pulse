# **Mail Pulse**

## Описание проекта

**MailPulse** - это веб-приложение на основе Django для управления рассылками сообщений. Сервис должен позволять пользователям создавать, редактировать, просматривать и удалять рассылки, а также отправлять сообщения клиентам вручную или по расписанию. Проект включает функциональность аутентификации, ограничения доступа, кеширования и аналитики для повышения эффективности и удобства использования.

### Проект разделен на две части

1. **Разработка сервиса** - создание базовой структуры, моделей, интерфейса и CRUD-операций.  
2. **Расширение функционала** - добавление аутентификации, прав доступа, кеширования и дополнительных возможностей, таких как автоматическая отправка и логирование.

---

## Техническое задание

### 1. Цели и требования

- Создание веб-приложения для управления рассылками сообщений с использованием Django.
- Обеспечение модульности, читаемости и соответствия стандартам разработки (PEP 8, структура Django).
- Реализация базовых и расширенных функций в соответствии с двумя частями проекта.
- Использование только необходимых зависимостей с вынесением конфигураций в переменные окружения.
- Поддержка GitHub-репозитория с правильной конфигурацией.

### 2. Функциональные требования

#### Часть 1: Разработка сервиса
- **Управление клиентами**:
  - Возможность добавления, просмотра, редактирования и удаления получателей рассылок (клиентов).
  - Модель "Получатель рассылки" включает поля: Email (уникальная строка), Ф.И.О. (строка), Комментарий (текст).
- **Управление сообщениями**:
  - Возможность добавления, просмотра, редактирования и удаления сообщений.
  - Модель "Сообщение" включает поля: Тема письма (строка), Тело письма (текст).
- **Управление рассылками**:
  - Возможность добавления, просмотра, редактирования и удаления рассылок.
  - Модель "Рассылка" включает поля: Дата и время первой отправки (datetime), Дата и время окончания (datetime), Статус (строка: "Создана", "Запущена", "Завершена"), Сообщение (внешний ключ на модель "Сообщение"), Получатели (многие-ко-многим связь с моделью "Получатель").
  - Статусы рассылки: "Создана" (создана, но не отправлена), "Запущена" (активна, отправлена хотя бы раз), "Завершена" (время окончания прошло).
- **Отправка сообщений по требованию**:
  - Поддержка ручной отправки рассылок через интерфейс и командную строку.
- **Попытки рассылок**:
  - Модель "Попытка рассылки" включает поля: Дата и время попытки (datetime), Статус (строка: "Успешно", "Не успешно"), Ответ почтового сервера (текст), Рассылка (внешний ключ на модель "Рассылка").
  - Логика работы: создание записи при каждой попытке отправки, определение получателей из списка, отправка через `send_mail()`, фиксация статуса и ответа сервера.
- **Главная страница**:
  - Отображение количества всех рассылок, активных рассылок (статус "Запущена") и уникальных получателей.

#### Часть 2: Расширение функционала
- **Регистрация и аутентификация пользователей**:
  - Поддержка регистрации с подтверждением email, входа, выхода и восстановления пароля.
- **Статистика и отчеты**:
  - Сбор и отображение данных о количестве успешных/неуспешных попыток и отправленных сообщениях для каждого пользователя.
- **Ограничение доступа**:
  - Доступ пользователей ограничен их собственными рассылками и клиентами.
  - Менеджеры имеют доступ к просмотру всех рассылок и клиентов, блокировке пользователей и отключению рассылок, но не могут редактировать или удалять чужие данные.
  - Модели рассылок, сообщений и получателей содержат поле "Владелец" с фильтрацией QuerySet по владельцу.
- **Кеширование**:
  - Наличие настроек серверного и клиентского кеширования для повышения производительности.
- **Дополнительные возможности (опционально)**:
  - Автоматическая отправка сообщений по расписанию с использованием `django-apscheduler`.
  - Логирование основных событий и ошибок.

### 3. Техническая реализация

- **Язык и фреймворк**: Python с использованием Django.
- **Зависимости**: Указаны в файле `requirements.txt`, включая только необходимые библиотеки (например, `django`, `django-apscheduler` для опции).
- **Структура проекта**:  
  - Корневая папка с настройками в `mail_pulse` или папке проекта.
  - Отдельные приложения: `users` (для пользователей), `mailings` (для рассылок).
  - Файл `.gitignore` для игнорирования ненужных файлов.
- **Переменные окружения**: Хранение конфигураций (например, `SECRET_KEY`, `DATABASE_URL`) в `.env`.
- **Миграции**: Создание и коммит миграций для всех моделей.

### 4. Критерии оценки

#### Общие критерии проекта
- Решение размещено на GitHub.
- Наличие файла `.gitignore`.
- Отсутствие игнорируемых файлов в коммитах.
- Присутствие файла `requirements.txt` с необходимыми зависимостями.
- Линтер Flake8 не выявляет ошибок.
- Соответствие структуры проектов Django.
- Наличие приложений `users` и `mailings`.
- Настройки находятся в корневой папке в `mail_pulse` или папке проекта.
- Выполнены базовые настройки проекта.
- Все данные вынесены в переменные окружения.
- Корректный шаблон файла `.env`.

#### Модели
- Модель "Рассылка" включает поля: 
  - Дата и время первой отправки
  - Дата и время окончания
  - Статус
  - Сообщение (внешний ключ)
  - Получатели (многие-ко-многим)
- Модель "Сообщение" включает поля: 
  - Тема письма
  - Тело письма
- Модель "Получатель рассылки" включает поля:
  - Email (уникальный)
  - Ф.И.О.
  - Комментарий.
- Модель "Попытка рассылки" включает поля:
  - Дата и время попытки
  - Статус
  - Ответ почтового сервера
  - Рассылка (внешний ключ)
- Модель пользователя наследуется от `AbstractUser` с полями:
  - email (для авторизации)
  - аватар
  - номер телефона
  - страна
- Все миграции запушены в репозиторий.
- Связи между моделями соответствуют ТЗ.
- `AUTH_USER_MODEL` заменен на кастомную модель.

#### Контроллеры и шаблоны
- Наличие контроллеров:
  - регистрация
  - аутентификация
  - выход
  - просмотр/редактирование профиля
- Реализация контроллеров и шаблонов CRUD для
  - сообщений
  - получателей
  - рассылок.
- Использование базового шаблона и подшаблонов.
- Корректная регистрация URL-адресов.
- Наличие страницы попыток рассылок.

#### Интерфейс
- Наличие кнопок "Вход", "Выход", "Регистрация" с корректным поведением после авторизации.
- Главная страница отображает количество рассылок, активных рассылок и уникальных получателей.
- Отдельные страницы для сообщений, рассылок, получателей и попыток с кнопками CRUD.
- Кнопки доступны только авторизованным пользователям.

#### Права доступа
- В классах `Meta` моделей добавлены права для менеджеров.
- Наличие группы "Менеджеры" с командой для наполнения базы.
- Поле "Владелец" в моделях с переопределенным методом `form_valid`.
- Фильтрация QuerySet по владельцу.

#### Кеширование
- Настроено серверное и клиентское кеширование.

#### Рассылки
- Наличие страницы отчетов по рассылкам.
- Поддержка отправки через интерфейс и командную строку.

### 5. Примеры работы

#### Пример 1: Создание и отправка рассылки
```bash
python manage.py runserver
```

- Переход на `/admin/`, вход как менеджер. 
- Создание рассылки: Дата начала - 2024-03-19 10:00, Дата окончания - 2024-03-19 12:00, Статус - "Создана". 
- Добавление получателей и сообщения.
- Нажатие "Отправить" → Логи появляются в консоли.

#### Пример 2: Просмотр статистики

- Авторизация как пользователь. 
- Переход на главную страницу → Отображение: "Всего рассылок: 5, Активных: 2, Получателей: 10". 
- Переход в раздел "Попытки рассылок" → Отображение успешных/неуспешных попыток.

### 6. Дополнительные рекомендации

- **Автоматизация**: С помощью `django-apscheduler` обеспечивается отправка писем по расписанию.
- **Логирование**: Настройка фиксации основных событий и ошибок с использованием стандартных средств Python.

> Если добавляются дополнительные классы для соблюдения принципа единственной ответственности (SRP), это способствует созданию более чистой, поддерживаемой и легко расширяемой структуры кода.

---

Удачи в реализации! 🚀
